<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML Preview</title>
    <!-- metadata -->
    <meta
      name="description"
      content="HTML Previewer to write and preview HTML code in real-time with syntax highlighting by iamickdev"
    />
    <meta
      name="keywords"
      content="HTML, Editor, Live, Preview, Code, Syntax, Highlighting, iamickdev"
    />
    <meta name="author" content="iamickdev" />
    <meta name="robots" content="index, follow" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@iamickdev" />
    <meta name="twitter:creator" content="@iamickdev" />

    <meta property="og:url" content="https://html-editor.iamickdev.com/preview" />
    <meta property="og:title" content="HTML Previewer | iamickdev" />
    <meta
      property="og:description"
      content="HTML Previewer to write and preview HTML code in real-time with syntax highlighting by iamickdev"
    />
    <meta
      property="og:image"
      content="https://html-editor.iamickdev.com//preview.png"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:type" content="website" />

    <link rel="icon" href="https://www.iamickdev.com/favicon.ico" />
    <link rel="canonical" href="https://html-editor.iamickdev.com/" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.0/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
      }
      #preview-content {
        width: 100%;
        height: 100vh;
        border: none;
        margin-top: 100px;
      }
      #error-message {
        display: none;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: red;
        text-align: center;
        padding: 20px;
        height: 90vh;
        width: 100%;
        font-size: 3em;
      }

      .navbar {
        background-color: #ffc107;
        color: #333;
        text-align: center;
        padding: 30px;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        display: flex;
        justify-content: space-between;
      }

      .navbar a {
        color: #333;
        text-decoration: none;
      }

      .navbar a:hover {
        text-decoration: underline;
        font-weight: bold;
      }

      .navbar h1 {
        margin: 0;
        font-size: 1.5em;
      }

      .navbar span {
        font-size: 0.5em;
        color: #333;
      }

      .navbar-icon {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <!-- HTML Previewer made with <3 by iamickdev -->
      <div>
        <h1>
          HTML Previewer
          <span
            >by
            <a href="https://www.iamickdev.com" target="_blank"
              >iamickdev</a
            ></span
          >
        </h1>
      </div>

      <div class="navbar-icon">
        <!-- Copy HTML content button -->
        <button onclick="copyToClipboard()">
          <i class="fas fa-copy"></i> Copy HTML
        </button>
        <!-- Download HTML content button -->
        <button onclick="downloadHTML()">
          <i class="fas fa-download"></i> Download HTML
        </button>
        <!-- Open in new tab button -->
        <button onclick="openInNewTab()">
          <i class="fas fa-external-link-alt"></i> Open in new tab
        </button>
        <!-- Download as image button -->
        <button onclick="downloadAsImage()">
          <i class="fas fa-image"></i> Download as image
        </button>

        <!-- Close nav for a while button-->
        <button class="close-nav" onclick="closeNavFor(60)">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </nav>

    <iframe id="preview-content"></iframe>
    <div id="error-message">
      <b>No HTML content provided or invalid preview key.</b>
    </div>

    <script>
      function closeNavFor(second) {
        document.querySelector(".navbar").style.display = "none";
        document.getElementById("preview-content").style.marginTop = "0";
        setTimeout(() => {
          document.querySelector(".navbar").style.display = "flex";
            document.getElementById("preview-content").style.marginTop = "100px";
        }, second * 1000);
      }

      function showCopiedMessage() {
        Swal.fire({
          title: "HTML copied to clipboard",
          text: "You can now paste it anywhere you want.",
          icon: "success",
          confirmButtonText: "Close",
          toast: true,
          position: "bottom",
          showConfirmButton: false,
          timer: 3000,
          showCloseButton: true,
        });
      }

      function copyToClipboard() {
        try {
          if (!navigator.clipboard) {
            var html = document.getElementById("preview-content").srcdoc;
            var textArea = document.createElement("textarea");
            textArea.value = html;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            showCopiedMessage();
            return;
          } else {
            var html = document.getElementById("preview-content").srcdoc;
            navigator.clipboard.writeText(html).then(
              function () {
                showCopiedMessage();
              },
              function (err) {
                console.error("Async: Could not copy text: ", err);
                Swal.fire({
                  title: "Error copying HTML",
                  text: "Please try again.",
                  icon: "error",
                  confirmButtonText: "Close",
                });
              }
            );
          }
        } catch (error) {
          Swal.fire({
            title: "Error copying HTML",
            text: "Please try again.",
            icon: "error",
            confirmButtonText: "Close",
          });
        }
      }

      function downloadHTML() {
        try {
          var html = document.getElementById("preview-content").srcdoc;
          var blob = new Blob([html], { type: "text/html" });
          var url = URL.createObjectURL(blob);
          var a = document.createElement("a");
          a.href = url;
          a.download = "preview.html";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        } catch (error) {
          Swal.fire({
            title: "Error downloading HTML",
            text: "Please try again.",
            icon: "error",
            confirmButtonText: "Close",
          });
        }
      }

      function openInNewTab() {
        try {
          var html = document.getElementById("preview-content").srcdoc;
          var blob = new Blob([html], { type: "text/html" });
          var url = URL.createObjectURL(blob);
          window.open(url, "_blank");
        } catch (error) {
          Swal.fire({
            title: "Error opening in new tab",
            text: "Please try again.",
            icon: "error",
            confirmButtonText: "Close",
          });
        }
      }

      function downloadAsImage() {
        try {
          var container = document.createElement("div");
          container.style.position = "absolute";
          container.style.top = "-9999px";
          container.style.left = "-9999px";
          container.style.width = "100%";
          container.style.height = "100%";
          container.innerHTML =
            document.getElementById("preview-content").srcdoc;

          document.body.appendChild(container);

          html2canvas(container)
            .then((canvas) => {
              var dataUrl = canvas.toDataURL("image/png");
              var a = document.createElement("a");
              a.href = dataUrl;
              a.download = "preview.png";
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);

              document.body.removeChild(container);
            })
            .catch((error) => {
              Swal.fire({
                title: "Error downloading image",
                text: "Please try again.",
                icon: "error",
                confirmButtonText: "Close",
              });
            });
        } catch (error) {
          Swal.fire({
            title: "Error downloading image",
            text: "Please try again.",
            icon: "error",
            confirmButtonText: "Close",
          });
        }
      }

      function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

      function base64Decode(str) {
        return decodeURIComponent(escape(window.atob(str)));
      }

      window.onload = function () {
        var key = getParameterByName("key");
        var base64Html = getParameterByName("html");
        var previewFrame = document.getElementById("preview-content");
        var errorMessage = document.getElementById("error-message");

        if (base64Html) {
          try {
            var decodedHtml = base64Decode(base64Html);
            previewFrame.srcdoc = decodedHtml;
          } catch (error) {
            previewFrame.style.display = "none";
            errorMessage.textContent = "Invalid Base64 encoded HTML content provided.";
            errorMessage.style.display = "flex";

            //create link for user to use our text editor instead (Please use our text editor instead here)
            const linkBox = document.createElement("div");
            const text = document.createElement("p")
            const link = document.createElement("a")
            linkBox.style.fontSize = "1.5em"
            text.textContent = "Please use our text editor instead"
            link.innerHTML = "&nbsp;here"
            link.style.color = "blue"
            link.href = "/"
            linkBox.appendChild(text)
            linkBox.appendChild(link)
            linkBox.style.display = "flex"
            linkBox.style.justifyContent = "center"
            linkBox.style.alignItems = "center"
            linkBox.style.marginTop = "20px"
            document.body.appendChild(linkBox)
          }
        } else if (key) {
          var html = localStorage.getItem(key);
          if (html) {
            previewFrame.srcdoc = html;
            localStorage.removeItem(key);
          } else {
            previewFrame.style.display = "none";
            errorMessage.textContent =
              "Preview content not found. It may have expired.";
            errorMessage.style.display = "flex";
          }
        } else {
          previewFrame.style.display = "none";
          errorMessage.style.display = "flex";
        }
      };
    </script>
  </body>
</html>
